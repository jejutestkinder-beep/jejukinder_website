---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import HeroIndex from '../components/HeroIndex.astro';
import Content3Col from '../components/Content3Col.astro';
import ContactSection from '../components/ContactSection.astro';
import NoticePopup from '../components/NoticePopup.astro';
import mainImage from '../assets/main-hero.png';
import space1 from '../assets/space-1.png';
import space2 from '../assets/space-2.png';
import space3 from '../assets/space-3.png';
import art1 from '../assets/art-1.png';
import art2 from '../assets/art-2.png';
import art3 from '../assets/art-3.png';
import nature1 from '../assets/nature-1.png';
import nature2 from '../assets/nature-2.png';
import nature3 from '../assets/nature-3.png';

const notices = await getCollection('notices');

const popupCandidates = notices
  .filter((n) => n.data.popup === true)
  .filter((n) => {
    const anyData = n.data as any;
    const until = anyData.popup_until;
    if (!until) return true;
    try {
      const untilMs = until instanceof Date ? until.getTime() : new Date(until).getTime();
      return Date.now() <= untilMs;
    } catch {
      return true;
    }
  });

popupCandidates.sort((a, b) => (a.slug < b.slug ? 1 : a.slug > b.slug ? -1 : 0));

const popupNotice = popupCandidates[0] ?? null;

let PopupContent: any = null;
if (popupNotice) {
  const rendered = await popupNotice.render();
  PopupContent = rendered.Content;
}
---

<Layout title="제주 발도르프 어린이집">
  {popupNotice && PopupContent && (
    <NoticePopup notice={popupNotice} Content={PopupContent} />
  )}

  <HeroIndex
    imageSrc={mainImage.src}
    subtitle="아이들이 꽃처럼 피어나는 곳"
    title="제주 발도르프 어린이집"
    ctaText="입소 상담하기"
    ctaLink="/admission/"
  />

  <Content3Col
    title="아름다운 공간에서"
    titleColor="brown"
    titleTag="h1"
    description="교사와 학부모가 꾸민 제주발도르프어린이집에서, 아이들은 매일 영감을 받습니다."
    descriptionColor="black"
    images={[
      { src: space1.src, alt: "공간 1" },
      { src: space2.src, alt: "공간 2" },
      { src: space3.src, alt: "공간 3" }
    ]}
  />

  <Content3Col
    title="예술적인 교육을"
    titleTag="h1"
    titleColor="brown"
    description="발도르프의 교육은 <strong>교육예술</strong>이라 합니다.<br />  제주발도르프어린이집에서는 아이의 발달 단계에 맞는 아름다운 예술 활동을 통해 창의력을 기릅니다."
    bgColor="bgPink"
    images={[
      { src: art1.src, alt: "예술 교육 1" },
      { src: art2.src, alt: "예술 교육 2" },
      { src: art3.src, alt: "예술 교육 3" }
    ]}
  />

  <Content3Col
    title="자연과 더불어"
    titleTag="h1"
    titleColor="brown"
    description="마을에서, 곶자왈에서, 마당에서, <br/ > 제주발도르프어린이집의 아이들은 매일 매일 자연과 만납니다."
    images={[
      { src: nature1.src, alt: "자연 1" },
      { src: nature2.src, alt: "자연 2" },
      { src: nature3.src, alt: "자연 3" }
    ]}
  />

  <ContactSection
    title="어린이집 입소 문의"
    linkText="입소 문의"
    linkUrl="https://docs.google.com/forms/d/e/1FAIpQLSccyRwbI42sdBHoiWLcz7A-BywQAY7I7ce_NVQUo6puvjFsVA/viewform"
  />
</Layout>