---
import Navigation from '../components/navigation.astro';
import Footer from '../components/footer.astro';
import Seo from '../components/Seo.astro';
import '../styles/global.css';

interface Props {
  title?: string;
  description?: string;
  canonical?: string;
  openGraph?: {
    title?: string;
    description?: string;
    image?: string;
    url?: string;
    type?: string;
  };
  twitterCard?: {
    title?: string;
    description?: string;
    image?: string;
    card?: 'summary' | 'summary_large_image';
  };
}

const { 
  title = 'ì œì£¼ ë°œë„ë¥´í”„ í‚¨ë”',
  description = 'ì œì£¼ ë°œë„ë¥´í”„ ì–´ë¦°ì´ì§‘',
  canonical,
  openGraph,
  twitterCard
} = Astro.props;
---

<!doctype html>
<html lang="ko">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¥</text></svg>" />
		<meta name="generator" content={Astro.generator} />

		<!-- Google Fonts -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Gaegu:wght@400;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />

		<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

		<Seo
			title={title}
			description={description}
			canonical={canonical}
			openGraph={openGraph}
			twitterCard={twitterCard}
		/>
	</head>

	<body>
		<Navigation />

		<main>
			<slot />
		</main>

		<Footer />
		<script is:inline>
			(function () {
				// Netlify Identity ìœ„ì ¯ì´ ë¡œë“œë  ë•Œê¹Œì§€ ëŒ€ê¸°
				function waitForIdentity() {
					if (!window.netlifyIdentity) {
						setTimeout(waitForIdentity, 50);
						return;
					}

					const hash = window.location.hash || "";
					const hasToken =
						hash.includes("invite_token=") ||
						hash.includes("recovery_token=") ||
						hash.includes("confirmation_token=");

					if (!hasToken) return;

					// admin í˜ì´ì§€ê°€ ì•„ë‹ˆë©´ adminìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
					if (!window.location.pathname.startsWith("/admin/")) {
						window.location.href = "/admin/" + hash;
						return;
					}

					// admin í˜ì´ì§€ì—ì„œ í† í° ì²˜ë¦¬
					function handleToken() {
						if (hash.includes("invite_token=") || hash.includes("recovery_token=")) {
							window.netlifyIdentity.open("signup");
						} else {
							window.netlifyIdentity.open();
						}
					}

					window.netlifyIdentity.on("init", handleToken);
					window.netlifyIdentity.init();

					// initì´ ì´ë¯¸ ì™„ë£Œë˜ì—ˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í•œ ë²ˆ ë” í™•ì¸
					setTimeout(handleToken, 100);
				}

				waitForIdentity();
			})();
		</script>
	</body>
</html>

<style>
	html {
		margin: 0;
		width: 100%;
		height: 100%;
	}

	body {
		margin: 0;
		width: 100%;
		min-height: 100vh;
		font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
		display: flex;
		flex-direction: column;
	}

	main {
		flex: 1;
		padding: 32px 24px;
	}

	/* Responsive Breakpoints */
	@media (max-width: 1024px) {
		main {
			padding: 24px 16px;
		}
	}

	@media (max-width: 768px) {
		main {
			padding: 20px 12px;
		}
	}

	@media (max-width: 480px) {
		main {
			padding: 16px 8px;
		}
	}
</style>