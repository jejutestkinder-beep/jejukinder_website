---
import Layout from '../../layouts/Layout.astro';
import Container from '../../components/Container.astro';
import PageTitle from '../../components/PageTitle.astro';
import Card from '../../components/Card.astro';
import FormInput from '../../components/FormInput.astro';
import FormTextarea from '../../components/FormTextarea.astro';
import FormButton from '../../components/FormButton.astro';
---

<Layout title="문의하기 - 제주 발도르프 킨더">
	<Container size="sm">
		<PageTitle subtitle="제주 발도르프 킨더에 문의사항이 있으시면 아래 양식을 작성해주세요.">
			문의하기
		</PageTitle>

		<Card class="p-8">
			<form
				id="contact-form"
				name="contact"
				method="POST"
			>
			<!-- Honeypot for spam protection -->
			<p class="hidden">
				<label>
					Don't fill this out if you're human: <input name="bot-field" />
				</label>
			</p>

			<!-- Form Fields using reusable components -->
			<FormInput
				label="이름"
				name="name"
				type="text"
				required={true}
				placeholder="홍길동"
			/>

			<FormInput
				label="이메일"
				name="email"
				type="email"
				required={true}
				placeholder="example@email.com"
			/>

			<FormInput
				label="연락처"
				name="phone"
				type="tel"
				required={true}
				placeholder="010-1234-5678"
			/>

			<FormTextarea
				label="메시지"
				name="message"
				required={true}
				rows={6}
				placeholder="문의하실 내용을 입력해주세요."
			/>

			<!-- Submit Button -->
			<div class="flex justify-end">
				<FormButton type="submit" variant="primary" size="lg">
					보내기
				</FormButton>
			</div>
			</form>
		</Card>

		<script>
			const form = document.getElementById('contact-form');
			if (form) {
				form.addEventListener('submit', (e) => {
					e.preventDefault();
					
					const formData = new FormData(form);
					const name = formData.get('name');
					const email = formData.get('email');
					const phone = formData.get('phone');
					const message = formData.get('message');
					const botField = formData.get('bot-field');
					
					// Honeypot 체크 (스팸 방지)
					if (botField) {
						return;
					}
					
					// 필수 필드 검증
					if (!name || !email || !phone || !message) {
						alert('모든 필드를 입력해주세요.');
						return;
					}
					
					// 이메일 내용 구성
					const subject = encodeURIComponent(`[제주 발도르프 어린이집] 문의하기: ${name}`);
					const body = encodeURIComponent(`새로운 문의가 접수되었습니다.

이름: ${name}
이메일: ${email}
연락처: ${phone}

메시지:
${message}

---
이 메시지는 제주 발도르프 어린이집 웹사이트 문의 폼에서 자동으로 전송되었습니다.`);
					
					// mailto 링크 생성
					const mailtoLink = `mailto:jejutestkinder@gmail.com?subject=${subject}&body=${body}`;
					
					// 이메일 클라이언트 열기
					window.location.href = mailtoLink;
					
					// 성공 페이지로 리다이렉트 (약간의 지연 후)
					setTimeout(() => {
						window.location.href = '/contact/success/';
					}, 500);
				});
			}
		</script>

	</Container>
</Layout>