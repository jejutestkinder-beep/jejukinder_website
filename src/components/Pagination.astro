---
interface Props {
  page: {
    currentPage: number;
    lastPage: number;
    url: {
      prev?: string;
      next?: string;
    };
  };
}

const { page } = Astro.props;

// Generate page numbers to display
// Show: First, ..., Current-2, Current-1, Current, Current+1, Current+2, ..., Last
function getPageNumbers(current: number, last: number): (number | 'ellipsis')[] {
  const delta = 2; // Pages to show on each side of current
  const range: (number | 'ellipsis')[] = [];

  for (let i = 1; i <= last; i++) {
    if (
      i === 1 || // Always show first page
      i === last || // Always show last page
      (i >= current - delta && i <= current + delta) // Show pages near current
    ) {
      range.push(i);
    } else if (range[range.length - 1] !== 'ellipsis') {
      range.push('ellipsis');
    }
  }

  return range;
}

const pageNumbers = getPageNumbers(page.currentPage, page.lastPage);

// Helper to build page URL
function getPageUrl(pageNum: number): string {
  if (pageNum === 1) {
    // First page is at root
    const baseUrl = page.url.prev?.split('/page/')[0] || page.url.next?.split('/page/')[0] || '';
    return baseUrl + '/';
  }
  const baseUrl = page.url.prev?.split('/page/')[0] || page.url.next?.split('/page/')[0] || '';
  return `${baseUrl}/page/${pageNum}/`;
}
---

<nav class="pagination-container" aria-label="페이지네이션">
  <div class="pagination-info">
    <p class="text-sm text-gray-600">
      페이지 {page.currentPage} / {page.lastPage}
    </p>
  </div>

  <ul class="pagination-list">
    <!-- Previous button (only show if more than 1 page) -->
    {page.lastPage > 1 && (
      <li>
        {page.url.prev ? (
          <a
            href={page.url.prev}
            class="pagination-btn pagination-arrow"
            aria-label="이전 페이지"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            <span class="hidden sm:inline">이전</span>
          </a>
        ) : (
          <span class="pagination-btn pagination-arrow pagination-disabled">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            <span class="hidden sm:inline">이전</span>
          </span>
        )}
      </li>
    )}

    <!-- Page numbers -->
    {pageNumbers.map((pageNum) => (
      <li>
        {pageNum === 'ellipsis' ? (
          <span class="pagination-ellipsis">...</span>
        ) : pageNum === page.currentPage ? (
          <span class="pagination-btn pagination-current" aria-current="page">
            {pageNum}
          </span>
        ) : (
          <a
            href={getPageUrl(pageNum)}
            class="pagination-btn pagination-number"
          >
            {pageNum}
          </a>
        )}
      </li>
    ))}

    <!-- Next button (only show if more than 1 page) -->
    {page.lastPage > 1 && (
      <li>
        {page.url.next ? (
          <a
            href={page.url.next}
            class="pagination-btn pagination-arrow"
            aria-label="다음 페이지"
          >
            <span class="hidden sm:inline">다음</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        ) : (
          <span class="pagination-btn pagination-arrow pagination-disabled">
            <span class="hidden sm:inline">다음</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </span>
        )}
      </li>
    )}
  </ul>
</nav>

<style>
  .pagination-container {
    margin-top: 2rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    align-items: center;
  }

  .pagination-info {
    text-align: center;
  }

  .pagination-list {
    display: flex;
    gap: 0.5rem;
    list-style: none;
    padding: 0;
    margin: 0;
    flex-wrap: wrap;
    justify-content: center;
  }

  .pagination-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.5rem 0.75rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.375rem;
    background-color: white;
    color: #374151;
    font-size: 0.875rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.2s;
    min-width: 2.5rem;
    justify-content: center;
  }

  .pagination-btn:not(.pagination-disabled):hover {
    background-color: #f9fafb;
    border-color: #d1d5db;
    color: #111827;
  }

  .pagination-current {
    background-color: #10b981; /* green-500 */
    color: white;
    border-color: #10b981;
  }

  .pagination-current:hover {
    background-color: #059669; /* green-600 */
    border-color: #059669;
  }

  .pagination-disabled {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
  }

  .pagination-ellipsis {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.5rem;
    color: #9ca3af;
    font-weight: 500;
  }

  .pagination-arrow {
    min-width: auto;
  }

  /* Mobile responsive */
  @media (max-width: 480px) {
    .pagination-btn {
      padding: 0.375rem 0.5rem;
      font-size: 0.8125rem;
      min-width: 2rem;
    }

    .pagination-list {
      gap: 0.25rem;
    }
  }
</style>
