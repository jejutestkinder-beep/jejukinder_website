---
interface Props {
  page: {
    currentPage: number;
    lastPage: number;
    url: {
      prev?: string;
      next?: string;
    };
  };
}

const { page } = Astro.props;

// Generate page numbers to display
// Show: First, ..., Current-2, Current-1, Current, Current+1, Current+2, ..., Last
function getPageNumbers(current: number, last: number): (number | 'ellipsis')[] {
  const delta = 2; // Pages to show on each side of current
  const range: (number | 'ellipsis')[] = [];

  for (let i = 1; i <= last; i++) {
    if (
      i === 1 || // Always show first page
      i === last || // Always show last page
      (i >= current - delta && i <= current + delta) // Show pages near current
    ) {
      range.push(i);
    } else if (range[range.length - 1] !== 'ellipsis') {
      range.push('ellipsis');
    }
  }

  return range;
}

const pageNumbers = getPageNumbers(page.currentPage, page.lastPage);

// Helper to build page URL
function getPageUrl(pageNum: number): string {
  if (pageNum === 1) {
    // First page is at root
    const baseUrl = page.url.prev?.split('/page/')[0] || page.url.next?.split('/page/')[0] || '';
    return baseUrl + '/';
  }
  const baseUrl = page.url.prev?.split('/page/')[0] || page.url.next?.split('/page/')[0] || '';
  return `${baseUrl}/page/${pageNum}/`;
}
---

<nav class="mt-8 flex flex-col gap-4 items-center" aria-label="페이지네이션">
  <div class="text-center">
    <p class="text-sm text-gray-600">
      페이지 {page.currentPage} / {page.lastPage}
    </p>
  </div>

  <ul class="flex flex-wrap gap-2 list-none p-0 m-0 justify-center">
    <!-- Previous button (only show if more than 1 page) -->
    {page.lastPage > 1 && (
      <li>
        {page.url.prev ? (
          <a
            href={page.url.prev}
            class="inline-flex items-center gap-1 px-3 py-2 border border-gray-200 rounded-md bg-white text-gray-700 text-sm font-medium no-underline transition-all hover:bg-gray-50 hover:border-gray-300 hover:text-gray-900 min-w-[2.5rem] justify-center sm:px-4"
            aria-label="이전 페이지"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            <span class="hidden sm:inline">이전</span>
          </a>
        ) : (
          <span class="inline-flex items-center gap-1 px-3 py-2 border border-gray-200 rounded-md bg-white text-gray-700 text-sm font-medium opacity-50 cursor-not-allowed min-w-[2.5rem] justify-center sm:px-4">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            <span class="hidden sm:inline">이전</span>
          </span>
        )}
      </li>
    )}

    <!-- Page numbers -->
    {pageNumbers.map((pageNum) => (
      <li>
        {pageNum === 'ellipsis' ? (
          <span class="inline-flex items-center justify-center p-2 text-gray-400 font-medium">...</span>
        ) : pageNum === page.currentPage ? (
          <span class="inline-flex items-center justify-center min-w-[2.5rem] px-3 py-2 rounded-md bg-custom-green text-white border border-custom-green font-medium text-sm sm:px-4" aria-current="page">
            {pageNum}
          </span>
        ) : (
          <a
            href={getPageUrl(pageNum)}
            class="inline-flex items-center justify-center min-w-[2.5rem] px-3 py-2 border border-gray-200 rounded-md bg-white text-gray-700 text-sm font-medium no-underline transition-all hover:bg-gray-50 hover:border-gray-300 hover:text-gray-900 sm:px-4"
          >
            {pageNum}
          </a>
        )}
      </li>
    ))}

    <!-- Next button (only show if more than 1 page) -->
    {page.lastPage > 1 && (
      <li>
        {page.url.next ? (
          <a
            href={page.url.next}
            class="inline-flex items-center gap-1 px-3 py-2 border border-gray-200 rounded-md bg-white text-gray-700 text-sm font-medium no-underline transition-all hover:bg-gray-50 hover:border-gray-300 hover:text-gray-900 min-w-[2.5rem] justify-center sm:px-4"
            aria-label="다음 페이지"
          >
            <span class="hidden sm:inline">다음</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        ) : (
          <span class="inline-flex items-center gap-1 px-3 py-2 border border-gray-200 rounded-md bg-white text-gray-700 text-sm font-medium opacity-50 cursor-not-allowed min-w-[2.5rem] justify-center sm:px-4">
            <span class="hidden sm:inline">다음</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </span>
        )}
      </li>
    )}
  </ul>
</nav>

<style>
  /* Mobile responsive adjustments */
  @media (max-width: 480px) {
    li a, li span {
      padding-left: 0.5rem !important;
      padding-right: 0.5rem !important;
      min-width: 2rem !important;
      font-size: 0.8125rem !important;
    }
  }
</style>
