---
import Pagination from './Pagination.astro';
import type { ImageMetadata } from 'astro';

interface Props {
  title: string;
  items: any[];
  type: 'board' | 'notice';
  bgImage?: ImageMetadata;
  imageAlt?: string;
  page?: {
    currentPage: number;
    lastPage: number;
    total: number;
    url: {
      prev?: string;
      next?: string;
    };
  };
}

const { title, items, type, bgImage, imageAlt = title, page } = Astro.props;

// Calculate starting index for post numbering
const totalPosts = page?.total || items.length;
const startIndex = page ? (page.currentPage - 1) * 15 : 0;
---

<div class="w-full">
  <!-- 헤더 with background image -->
  {bgImage ? (
    <div class="relative overflow-hidden h-[40vh] min-h-[250px] md:h-[35vh] md:min-h-[200px] w-[calc(100%+48px)] -mx-6 -mt-[32px] md:-mt-[32px] mb-8">
      <img src={bgImage.src} alt={imageAlt} class="absolute inset-0 w-full h-full object-cover" />
      <div class="absolute inset-0 bg-black/40 z-10"></div>
      <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full px-6 text-center z-20">
        <h1 class="text-white drop-shadow-lg m-0 mb-2">{title}</h1>
        <p class="text-white drop-shadow-lg m-0 text-sm md:text-base">
          총 {totalPosts}개의 {type === 'board' ? '글' : '공지'}
          {page && page.lastPage > 1 && (
            <span class="text-white/80 ml-2">
              (페이지 {page.currentPage} / {page.lastPage})
            </span>
          )}
        </p>
      </div>
    </div>
  ) : (
    <div class="mb-8 text-center">
      <h1 class="mb-2 text-custom-brown">{title}</h1>
      <p class="text-gray-600">
        총 {totalPosts}개의 {type === 'board' ? '글' : '공지'}
        {page && page.lastPage > 1 && (
          <span class="text-gray-400 ml-2">
            (페이지 {page.currentPage} / {page.lastPage})
          </span>
        )}
      </p>
    </div>
  )}

  <!-- 테이블 -->
  <div class="px-12">
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
    <table class="w-full">
      <thead class="bg-gray-50 border-b border-gray-200">
        <tr>
          <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700 w-20">
            번호
          </th>
          {type === 'board' && (
            <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700 hidden md:table-cell w-32">
              카테고리
            </th>
          )}
          <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">
            제목
          </th>
          <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700 hidden lg:table-cell w-28">
            작성자
          </th>
          <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700 hidden sm:table-cell w-32">
            날짜
          </th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        {items.map((item, index) => (
          <tr class="hover:bg-gray-50 transition-colors">
            <td class="px-6 py-4 text-sm text-gray-600">
              {totalPosts - (startIndex + index)}
            </td>

            {type === 'board' && (
              <td class="px-6 py-4 text-sm hidden md:table-cell">
                {item.data.category ? (
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-custom-lightPink text-custom-green">
                    {item.data.category}
                  </span>
                ) : (
                  <span class="text-gray-400">-</span>
                )}
              </td>
            )}

            <td class="px-6 py-4">
              <a
                href={type === 'board' ? `/board/${item.slug}/` : `/notices/${item.slug}/`}
                class={`hover:text-custom-green transition-colors ${type === 'notice' ? 'font-medium' : ''} text-gray-900`}
              >
                {item.data.title}
              </a>

              {type === 'board' && item.data.category && (
                <span class="md:hidden ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-custom-lightPink text-custom-green">
                  {item.data.category}
                </span>
              )}

              {type === 'notice' && item.data.popup && (
                <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-custom-lightPink text-custom-rose">
                  중요
                </span>
              )}
            </td>

            <td class="px-6 py-4 text-sm text-gray-600 hidden lg:table-cell">
              {item.data.author || '-'}
            </td>

            <td class="px-6 py-4 text-sm text-gray-600 hidden sm:table-cell">
              {item.data.date
                ? new Date(item.data.date).toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                  }).replace(/\./g, '.').replace(/\s/g, '')
                : '-'}
            </td>
          </tr>
        ))}

        {items.length === 0 && (
          <tr>
            <td
              colspan={type === 'board' ? '5' : '4'}
              class="px-6 py-12 text-center text-gray-500"
            >
              등록된 {type === 'board' ? '게시글' : '공지사항'}이 없습니다.
            </td>
          </tr>
        )}
      </tbody>
    </table>
    </div>
  </div>

  <!-- Pagination -->
  {page && <Pagination page={page} />}
</div>
